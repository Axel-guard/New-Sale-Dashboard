<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sales Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <header class="topbar">
    <h1>Sales Dashboard</h1>
    <div class="controls">
      <label for="monthSelect">Month:</label>
      <select id="monthSelect"></select>

      <label for="employeeSearch" class="sr-only">Search employee</label>
      <input id="employeeSearch" placeholder="Search employee" />
      <button id="exportCsv">Export CSV</button>
      <button id="downloadJson" title="Download updated sales.json">Download JSON</button>
      <button id="openAddSale" class="accent">Add Sale</button>
    </div>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <h2>Employees</h2>
      <ul id="employeeList" class="employee-list"></ul>
      <hr/>
      <div class="summary" id="kpiBoxes">
        <!-- KPI boxes inserted here -->
      </div>
    </aside>

    <section class="content">
      <section class="charts">
        <div class="chart-card">
          <h3>Sales by Employee</h3>
          <canvas id="barChart" height="140"></canvas>
        </div>
        <div class="chart-card">
          <h3>Payment Status</h3>
          <canvas id="doughnutChart" height="140"></canvas>
        </div>
      </section>

      <section class="table-card">
        <h3>Sales - Details</h3>
        <div class="table-actions">
          <label><input type="checkbox" id="showAllPayments" checked /> Show full payment rows</label>
          <input id="globalSearch" placeholder="Search customer, product, employee..." />
        </div>
        <table id="salesTable">
          <thead>
            <tr>
              <th>Customer</th>
              <th>Date</th>
              <th>Employee</th>
              <th>Products</th>
              <th>Total</th>
              <th>Payment Status</th>
              <th>Payments</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>
    </section>
  </main>

  <!-- Payment details template -->
  <template id="paymentRowTemplate">
    <tr class="payment-row">
      <td colspan="7" class="payment-details"></td>
    </tr>
  </template>

  <!-- Add Sale Modal -->
  <div id="addSaleModal" class="modal" aria-hidden="true" style="display:none;">
    <div class="modal-content">
      <button id="closeAddSale" class="modal-close">✕</button>
      <h2>Add Sale</h2>
      <form id="addSaleForm">
        <label>Customer<br/><input name="customer" required /></label>
        <label>Date<br/><input name="date" type="datetime-local" required /></label>
        <label>Employee<br/><input name="employee" required /></label>

        <div class="field-group">
          <label>Product<br/><input name="product" required /></label>
          <label>Qty<br/><input name="qty" type="number" min="1" value="1" required /></label>
          <label>Price<br/><input name="price" type="number" min="0" value="0" required /></label>
        </div>

        <label>Total (auto)<br/><input name="total" id="totalField" readonly /></label>

        <div class="field-group">
          <label>Payment 1 — Amount<br/><input name="p_amount_1" type="number" min="0" value="0" /></label>
          <label>Method<br/><input name="p_method_1" /></label>
        </div>

        <div style="margin-top:10px;display:flex;gap:8px;">
          <button type="submit">Add & Save (local)</button>
          <button id="downloadSingle" type="button">Download JSON</button>
          <button type="button" id="cancelAdd">Cancel</button>
        </div>

        <p class="muted">New entries are saved locally (in your browser). Use "Download JSON" to get a file you can upload to GitHub to make entries permanent.</p>
      </form>
    </div>
  </div>

  <script src="app.js"></script>
  <script>
    // basic modal styling/behavior without extra CSS frameworks
    (function(){
      const modal = document.getElementById('addSaleModal');
      const openBtn = document.getElementById('openAddSale');
      const closeBtn = document.getElementById('closeAddSale');
      const cancelBtn = document.getElementById('cancelAdd');

      function open(){ modal.style.display='block'; modal.setAttribute('aria-hidden','false'); }
      function close(){ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); }

      openBtn.addEventListener('click', open);
      closeBtn.addEventListener('click', close);
      cancelBtn.addEventListener('click', close);
      // close on outside click
      modal.addEventListener('click', (e)=>{ if(e.target===modal) close(); });
    })();
  </script>

  <style>
    /* very small modal styles */
    .modal{position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.35);display:flex;align-items:center;justify-content:center;z-index:40}
    .modal-content{background:#fff;padding:18px;border-radius:10px;max-width:720px;width:94%;position:relative}
    .modal-close{position:absolute;right:8px;top:6px;border:0;background:transparent;font-size:18px;cursor:pointer}
    label{display:block;margin:8px 0}
    input{width:100%;padding:8px;border-radius:6px;border:1px solid #dde7f5}
    .field-group{display:flex;gap:8px}
    .field-group label{flex:1}
    .muted{color:#6b7280;font-size:0.9rem}
    #openAddSale.accent{background:#2563eb;color:white;border-radius:6px;padding:8px 10px;border:0}
  </style>
</body>
</html>
