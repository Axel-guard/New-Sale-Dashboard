<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sales Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <header class="topbar">
    <h1>Sales Dashboard</h1>
    <div class="controls">
      <label for="monthSelect">Month:</label>
      <select id="monthSelect"></select>

      <label for="employeeSearch" class="sr-only">Search employee</label>
      <input id="employeeSearch" placeholder="Search employee" />
      <button id="exportCsv">Export CSV</button>
      <button id="downloadJson" title="Download updated sales.json">Download JSON</button>
      <button id="openAddSale" class="accent">Add Sale</button>
    </div>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <h2>Employees</h2>
      <ul id="employeeList" class="employee-list"></ul>
      <hr/>
      <div class="summary" id="kpiBoxes"></div>
    </aside>

    <section class="content">
      <section class="charts">
        <div class="chart-card">
          <h3>Sales by Employee</h3>
          <canvas id="barChart" height="140"></canvas>
        </div>
        <div class="chart-card">
          <h3>Payment Status</h3>
          <canvas id="doughnutChart" height="140"></canvas>
        </div>
      </section>

      <section class="table-card">
        <h3>Sales - Details</h3>
        <div class="table-actions">
          <label><input type="checkbox" id="showAllPayments" checked /> Show full payment rows</label>
          <input id="globalSearch" placeholder="Search customer, product, employee..." />
        </div>
        <table id="salesTable">
          <thead>
            <tr>
              <th>Customer</th>
              <th>Date</th>
              <th>Employee</th>
              <th>Products</th>
              <th>Total</th>
              <th>Payment Status</th>
              <th>Payments</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>
    </section>
  </main>

  <!-- Payment details template -->
  <template id="paymentRowTemplate">
    <tr class="payment-row">
      <td colspan="7" class="payment-details"></td>
    </tr>
  </template>

  <!-- Add Sale Modal (popup) -->
  <div id="addSaleModal" class="modal" aria-hidden="true" style="display:none;">
    <div class="modal-content">
      <button id="closeAddSale" class="modal-close">✕</button>
      <h2>Add Sale</h2>
      <!-- BEGIN: simplified form -->
<label>Customer Code<br/><input name="cust_code" required /></label>

<label>Sale Date<br/><input name="date" type="date" required /></label>

<label>Employee<br/>
  <select name="employee" required>
    <option value="">-- select --</option>
    <option>Akash Parashar</option>
    <option>Mandeep Samal</option>
    <option>Smruti Ranjan Nayak</option>
  </select>
</label>

<div class="field-group">
  <label>Amount Received<br/><input name="amount_received" type="number" min="0" value="0" required /></label>
  <label>Which Account<br/>
    <select name="account" required>
      <option value="">-- select --</option>
      <option>IDFC 4828</option>
      <option>IDFC 7455</option>
      <option>Canara Bank</option>
      <option>Cash</option>
    </select>
  </label>
</div>

<label>Payment Reference Number<br/><input name="payment_ref" placeholder="UTR / Txn ID / Cash slip" /></label>

<label>Courier Cost (₹)<br/><input name="courier_cost" type="number" min="0" value="0" /></label>

<!-- PRODUCTS (up to 10) -->
<div id="productsContainer">
  <div class="product-row">
    <label>Product 1 - Name<br/><input name="product_1" required /></label>
    <label>Qty<br/><input name="qty_1" type="number" min="1" value="1" required /></label>
    <label>Price<br/><input name="price_1" type="number" min="0" value="0" required /></label>
  </div>
</div>
<button id="addProductRow" type="button">Add another product</button>

<label>Total (auto)<br/><input name="total" id="totalField" readonly /></label>

<div style="margin-top:10px;display:flex;gap:8px;">
  <button type="submit">Add & Save to GitHub</button>
  <button id="downloadSingle" type="button">Download Single JSON</button>
  <button type="button" id="cancelAdd">Cancel</button>
</div>
<p class="muted">This form keeps only the fields you requested. You can add up to 10 products.</p>
<!-- END: simplified form -->

    </div>
  </div>

  <script src="app.js"></script>

  <style>
    /* small modal styles */
    .modal{position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:40}
    .modal-content{background:#fff;padding:18px;border-radius:10px;max-width:720px;width:94%;position:relative;box-shadow:0 10px 40px rgba(2,6,23,0.2)}
    .modal-close{position:absolute;right:8px;top:6px;border:0;background:transparent;font-size:18px;cursor:pointer}
    label{display:block;margin:8px 0}
    input, select{width:100%;padding:8px;border-radius:6px;border:1px solid #dde7f5}
    .field-group{display:flex;gap:8px}
    .product-row{display:grid;grid-template-columns:1fr 120px 120px;gap:8px;align-items:end}
    .muted{color:#6b7280;font-size:0.9rem}
    #openAddSale.accent{background:#2563eb;color:white;border-radius:6px;padding:8px 10px;border:0}
    #addProductRow{margin-bottom:8px}
  </style>
</body>
</html>
